(function(e){function a(e){var t=0,n,r;e+="";if(e.length===0)return t;for(n=0;n<e.length;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t&=t;return t}function f(e,t,n){this.container=e,this.name=t,this.map=n,this.markers=[],this.visible=!0}function l(e,t){this.marker=e,this.selected=!1,this.listeners={},this.element=t.element,this.map=t.map,this.group=t.group,this.config=t}function c(e){var t=e.dataTransfer.getData("application/map-drag-type"),n=this.marker,r;return t.match(/marker/i)&&(r=e.dataTransfer.getData("application/map-drag-object-offset"),e.drag=this.map.pixelToGeo(e.displayX-r.x+n.anchor.x,e.displayY-r.y+n.anchor.y)),e}function h(t){if(!this.listeners[t])return;var n=this,r=e.Event(t,{geo:this.marker.coordinate});e.each(this.listeners[t],function(e,t){t.call(n,r)})}function p(e){this.marker.set("brush",{color:e})}function d(e){this.marker.set("icon",e)}function v(){if(n)return;n=nokia.maps}function m(e){return typeof e=="function"}var t="ungrouped",n,r,i,s,o={marker:{text:"",textColor:"#333333",fill:"#ff6347",stroke:"#333333",shape:"balloon",icon:undefined,group:t}},u={};s=f.prototype,s.addMarker=function(e){this.markers.push(e)},s.hide=function(){this.visible&&(this.map.objects.remove(this.container),this.visible=!1)},s.show=function(){this.visible||(this.map.objects.add(this.container),this.visible=!0)},s.toggle=function(){if(this.visible)return this.hide();this.show()},s.zoomTo=function(){this.map.zoomTo(this.container.getBoundingBox())},e.jHERE.getMarkersGroup=function(n,r){var i;return e.jHERE.ready(function(){n=n||t,i=u[n],m(r)&&r.call(i,i)}),i},i=l.prototype,i.on=function(t,n){var r,i;this.listeners[t]||(this.listeners[t]={}),r=function(t){t.type&&t.type.match(/drag/i)&&(t=c.call(this,t));var r=e.Event(t.type,{originalEvent:t,geo:{latitude:this.marker.coordinate.latitude,longitude:this.marker.coordinate.longitude},drag:t.drag,target:t.target});n.call(this,r)},i=e.proxy(r,this),this.listeners[t][""+a(n)]=i,this.marker.addListener(t,i)},i.off=function(t,n){var r=this.listeners;if(!n){e.each(r[t],function(e,n){this.marker.removeListener(t,n)});return}this.marker.removeListener(t,r[t][""+a(n)])},i.remove=function(){u[this.group.name].container.objects.remove(this.marker),h.call(this,"removed")},i.add=function(){u[this.group.name].container.objects.add(this.marker),h.call(this,"added")},i.select=function(){this.selected=!0;if(this.config.icon)return d.call(this,this.config.selectedIcon||this.config.icon);p.call(this,this.config.selectedFill||this.config.fill)},i.deselect=function(){this.selected=!1;if(this.config.icon)return d.call(this,this.config.icon);p.call(this,this.config.fill)},i.toggleSelection=function(){if(this.selected)return this.deselect();this.select()},r=function(t,r,i){var s;v(),e.isFunction(r)&&(i=r,r={}),i=i||e.noop,r=e.extend({},o.marker,r),r.textPen=r.textPen||{strokeColor:r.textColor},r.pen=r.pen||{strokeColor:r.stroke},r.brush=r.brush||{color:r.fill},u[r.group]||(u[r.group]=new f(new n.map.Container,r.group,this.map),this.map.objects.add(u[r.group].container)),r.group=u[r.group],r.map=this.map,r.icon?s=new l(new n.map.Marker(t,r),r):s=new l(new n.map.StandardMarker(t,r),r),s.add(),i.call(this.element,s,s.group)},e.jHERE.extend("marker",r)})(jQuery);